<html>
<head>
   <link rel="stylesheet" href="css/bootstrap.min.css">
   
   <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/bootstrap-table.min.css" rel="stylesheet" />

   <title>table link</title>
<style>

.bottone{
background-color:rgb(239,187,77); 
color:rgb(68,122,97);
}



.modello{
		background-color: rgb(68,122,97);
	color : white;
}

body{
	background-color: rgb(68,122,97);
	color : white;
}

input[type="radio"]:checked:before {
    content: "";
    display: block;
    position: relative;
    top: 2px;
    left: 1px;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: rgb(239,180,77);
}

      #selectedColumn input{
          width:100%;
          margin-left:20px; 
          margin-right:20px;
        }

table {  
	border-collapse: collapse; 
	width: 100%; 
	color: white;
}

tr:hover {
    color: black ;
}




.tableFixHead {

	margin-left:20px;
	margin-right:20px;
  height: 50%;
}

.tableFixHead thead th {
background-color : white; 
color :rgb(239,180,77);
  position: sticky;
  top: 0;
}

tbody{
background-color: rgb(105,148,142);
}


</style>
</head>
<body ng-app="myApp" ng-controller="MainController">

      <h1 align="center" >Table link </h1>
      
<div class="container" style="width:100%; margin-left:20px;  padding:0;" >
  <h2>Ricerca</h2>
  <p>Seleziona la colonna su cui fare la ricerca:</p>
  <form >
    <label class="radio-inline">
      <input type="radio" id="ricanno" name="ricerca" value="anno">Anno
    </label>
    <label class="radio-inline">
      <input type="radio" id="rictipologia" name="ricerca" value="tipologia">Tipologia
    </label>
    <label class="radio-inline">
      <input type="radio" id="ricmateria" name="ricerca" value="materia">Materia
    </label>
    <label class="radio-inline">
      <input type="radio" id="ricprofessore" name="ricerca" value="professore">Professore
    </label>
    <label class="radio-inline">
      <input type="radio" id="riclink" name="ricerca" value="link">Link
    </label>
    
    <label style="float:right; margin-right:40px;" >Ricerca:
    	<input id="dls_search_input" onkeyup="search_table()" type="text" />
   	</label>
   	
  </form>

</div>
      
<div class="tableFixHead" >
	<table id="selectedColumn" data-toggle="table" data-url="http://localhost:4567/get_link_table" data-sort-name="anno" data-sort-order="desc" >
	    <thead>
	        <tr>
	            <th data-field="anno" data-sortable="true"> Anno </th>
	            <th data-field="tipologia" data-sortable="true"> Tipologia </th>
	            <th data-field="materia" data-sortable="true"> Materia </th>
	            <th data-field="professore" data-sortable="true"> Professore </th>
	            <th data-field="link" data-sortable="true"> Link </th>
	            <th data-field="action" data-formatter="caricaBottoni">Azioni</th>
	        </tr>
	    </thead>
	</table>
</div>

<div style="padding:20px;">
  <button data-toggle='modal' data-target='#myModal2' class='btn bottone'>Aggiungi</button>
</div>



<script>



function search_table(){
 	var input = document.getElementById("dls_search_input");
    var filter = input.value.toUpperCase();
    var table = document.getElementById("selectedColumn");
    var tr = table.getElementsByTagName("tr");
 	var riga = [];
 	var testo = "";
 	
 	
    for (var k= 1 ; k <tr.length; k++){
        riga = tr[k].getElementsByTagName("td");
    	for (var j = 0; j < riga.length; j++){
    		testo = riga[j].innerText.toUpperCase();
    		
    		if(j==0){
    			if( document.getElementById("ricanno").checked ){
	    			if(testo.indexOf(filter) > -1){
	    				tr[k].style.display = "";
		        	} else {
		            	tr[k].style.display = "none";
		        	} 
    			}
    		}
    		
    		if(j==1){
    			if( document.getElementById("rictipologia").checked ){
	    			if(testo.indexOf(filter) > -1){
	    				tr[k].style.display = "";
		        	} else {
		            	tr[k].style.display = "none";
		        	} 
    			}
    		}
    		
    		if(j==2){
    			if( document.getElementById("ricmateria").checked ){
	    			if(testo.indexOf(filter) > -1){
	    				tr[k].style.display = "";
		        	} else {
		            	tr[k].style.display = "none";
		        	} 
    			}
    		}
    		
    		if(j==3){
    			if( document.getElementById("ricprofessore").checked ){
	    			if(testo.indexOf(filter) > -1){
	    				tr[k].style.display = "";
		        	} else {
		            	tr[k].style.display = "none";
		        	} 
    			}
    		}
    		
    		if(j==4){
    			if( document.getElementById("riclink").checked ){
	    			if(testo.indexOf(filter) > -1){
	    				tr[k].style.display = "";
		        	} else {
		            	tr[k].style.display = "none";
		        	} 
    			}
    		}
    		
    		
    		
    	}
    	
    }
    
    //console.log(checked());
    
}






    function caricaBottoni(value, row, index) {
    	
        return " <button id='"+index+"' class='btn btn-danger' onclick='cancella(this.id)'>Cancella</button><button id='"+index+"' data-toggle='modal' data-target='#myModal' class='btn bottone' onclick='modifica(this.id)'>Modifica</button>";
    }
    
    function cancella(a){
    	var i = 0;
    	var link = "";
    	$('td', $("table").find("[data-index='" + a + "']")[0]).each(function() {
	    	if (i == 4){
	    		link = $(this).html().split("amp;").join("");
	    	}
	    	i++;
		        //console.log($(this).html());
    	});
    	axios({
    		method:'post',
    		url :'http://localhost:4567/delete',
    		data :  link
    		})
    		
    	window.location.reload();
    }
    var vecchio_links = "";
    function modifica(a){
    	
    	//console.log($("table").find("[data-index='" + a + "']")[0]);
    	var i = 0;
    	var link = "";
    	var anno = 0;
    	var tipologia = "";
    	var professore = "";
    	var materia = "";
    	$('td', $("table").find("[data-index='" + a + "']")[0]).each(function() {
    		if (i == 0){
	    		anno = $(this).html();
	    	}
	    	if (i == 1){
	    		tipologia = $(this).html();
	    	}
	    	if (i == 2){
	    		materia = $(this).html();
	    	}
	    	if (i == 3){
	    		professore = $(this).html();
	    	}
	    	if (i == 4){
	    		
	    		link = $(this).html().split("amp;").join("");
	    		vecchio_links=link;
	    	}
	    	i++;
		        //console.log($(this).html());
    	});
    	//console.log(link);
    	
    	document.getElementById("fTipologia").value = tipologia;
    	document.getElementById("fAnno").value = anno;
    	document.getElementById("fMateria").value = materia;
    	document.getElementById("fProfessore").value = professore;
    	document.getElementById("fLink").value = link;
    }
    

    
    function completaModifica(){
    
    console.log("ok", vecchio_links);
        var link = "";
    	var anno = 0;
    	var tipologia = "";
    	var professore = "";
    	var materia = "";
    	tipologia = document.getElementById("fTipologia").value;
    	anno = document.getElementById("fAnno").value;
    	materia = document.getElementById("fMateria").value ;
    	professore = document.getElementById("fProfessore").value;
    	link = document.getElementById("fLink").value;
    	
    	var recordMod = {
    	"link_vecchio" : vecchio_links,
    	"link" : link,
    	"anno" : anno,
    	"tipologia" : tipologia,
    	"professore" : professore,
    	"materia" : materia
    	};
    	
    	axios({
    		method:'post',
    		url :'http://localhost:4567/update',
    		data :  recordMod
    		})
    	window.location.reload();
    }
    
    
    
    function completaAggiunta(){
    
        var link = "";
    	var anno = 0;
    	var tipologia = "";
    	var professore = "";
    	var materia = "";
    	tipologia = document.getElementById("fTipologia2").value;
    	anno = document.getElementById("fAnno2").value;
    	materia = document.getElementById("fMateria2").value ;
    	professore = document.getElementById("fProfessore2").value;
    	link = document.getElementById("fLink2").value;
    	
    	var record = {
    	"link" : link,
    	"anno" : anno,
    	"tipologia" : tipologia,
    	"professore" : professore,
    	"materia" : materia
    	};
    	console.log(record);
    	axios({
    		method:'post',
    		url :'http://localhost:4567/add',
    		data :  record
    		})
    	window.location.reload();
    }
    
    
</script>

 


  <!-- Modal modifica -->
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content modello">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Modifica</h4>
        </div>
 <form id="formMod" style="margin-left:20px; margin-right:20px;">
  <div class="form-group">
    <label style="margin-top:10px;" for="formAnno">Anno</label>
    <input id="fAnno" type="number" class="form-control" placeholder="example">
  </div>
  <div class="form-group">
    <label for="formTipologia">Tipologia</label>
    <select class="form-control" id="fTipologia">
      <option>Triennale</option>
      <option>Magistrale</option>
    </select>
  </div>
  <div class="form-group">
    <label for="formMateria">Materia</label>
    <input id="fMateria" type="text" class="form-control" id="formMateria" placeholder="example">
  </div>
  <div class="form-group">
    <label for="formProfessore">Professore</label>
    <input id="fProfessore" type="text" class="form-control" id="formProfessore" placeholder="example">
  </div>
  <div class="form-group">
    <label for="formLink">Link</label>
    <input id="fLink" type="text" class="form-control" id="formLink" placeholder="example">
  </div>
  <div class="form-group">
  <button class='btn bottone' onclick="completaModifica()">Modifica</button>
  </div>
</form>
      </div>
      
    </div>
  </div>
  
  
  
  
  <!-- Modal aggiungi -->
  <div class="modal fade" id="myModal2" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content modello">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Aggiungi</h4>
        </div>
 <form id="formMod" style="margin-left:20px; margin-right:20px;">
  <div class="form-group">
    <label style="margin-top:10px;" for="formAnno">Anno</label>
    <input id="fAnno2" type="number" class="form-control" placeholder="example">
  </div>
  <div class="form-group">
    <label for="formTipologia">Tipologia</label>
    <select class="form-control" id="fTipologia2">
      <option>Triennale</option>
      <option>Magistrale</option>
    </select>
  </div>
  <div class="form-group">
    <label for="formMateria">Materia</label>
    <input id="fMateria2" type="text" class="form-control" id="formMateria2" placeholder="example">
  </div>
  <div class="form-group">
    <label for="formProfessore">Professore</label>
    <input id="fProfessore2" type="text" class="form-control" id="formProfessore2" placeholder="example">
  </div>
  <div class="form-group">
    <label for="formLink">Link</label>
    <input id="fLink2" type="text" class="form-control" id="formLink2" placeholder="example">
  </div>
  <div class="form-group">
  <button class='btn bottone' onclick="completaAggiunta()">Aggiungi</button>
  </div>
</form>
      </div>
      
    </div>
  </div>
  
  
  
  

 
</body>

    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/angular.min.js"></script>
    <script type="text/javascript" src="js/app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/bootstrap-table.min.js"></script>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

</html>